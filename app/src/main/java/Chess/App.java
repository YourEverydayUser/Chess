/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package Chess;

import GameSession.GameSession;
import Pieces.Field;
import Pieces.Figures.Figure;

import javax.swing.*;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.io.IOException;
import java.util.ArrayList;

public class App {

    public static void main(String[] args) throws IOException {
        GameSession gameSession = GameSession.getInstance();
        JFrame frame = new JFrame();
        ChessBoardPanel panel = new ChessBoardPanel(gameSession.accessBoard().getGameBoard());
        gameSession.addObserver(panel);

        frame.setBounds(100, 100, 512, 512);
        frame.setUndecorated(true);
        frame.add(panel);
        frame.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
        frame.setVisible(true);
        panel.addMouseListener(new MouseAdapter() {
            private int firstX = -1;
            private int firstY = -1;

            @Override
            public void mousePressed(MouseEvent e) {
                int x = e.getX() / 64;
                int y = e.getY() / 64;

                if (firstX == -1 && firstY == -1) {
                    firstX = x;
                    firstY = y;
                    System.out.println("From field x:" + x + "   y: " + y);
                    Figure figure = gameSession.accessBoard().getGameBoard().get(gameSession.accessBoard().getKeys()[x][y]);
                    if(figure != null) {
                        ArrayList<Field> possibleMoves = gameSession.accessBoard().getValidMoves(figure);
                        panel.paintPossibleMove(panel.getGraphics(),  possibleMoves);
                        for(Field field : possibleMoves) {
                            System.out.println("x =  " + field.getxCoordinate() + "   y =  " + field.getyCoordinate());
                        }
                    }
                } else {
                    Field fromField = gameSession.accessBoard().getKeys()[firstX][firstY];
                    Field toField = gameSession.accessBoard().getKeys()[x][y];
                    int message = gameSession.playTurn(fromField, toField);
                    System.out.println("To field x:" + x + "   y: " + y);
                    switch (message) {
                        case 1 -> {
                            JOptionPane.showMessageDialog(null, "Error: No Figure at the given point");
                            panel.repaint();
                        }
                        case 2 -> {
                            JOptionPane.showMessageDialog(null, "Error: Other players turn");
                            panel.repaint();
                        }
                        case 3 -> {
                            JOptionPane.showMessageDialog(null, "Error: Not a valid move.");
                            panel.repaint();
                        }
                        case 4 -> panel.repaint();
                    }
                    firstX = -1;
                    firstY = -1;
                }

            }
        });
    }
}
